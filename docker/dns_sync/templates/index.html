{% extends "base.html" %}

{% block content %}

<!-- Status banner -->
{% if summary.total > 0 %}
<div id="status-banner" class="mb-6 rounded-lg px-4 py-3 flex items-center gap-3 text-sm font-medium
  {% if summary.errors > 0 %}
    bg-red-900/40 border border-red-700 text-red-200
  {% elif summary.never > 0 and summary.ok == 0 %}
    bg-gray-700/50 border border-gray-600 text-gray-300
  {% elif summary.never > 0 %}
    bg-yellow-900/30 border border-yellow-700 text-yellow-200
  {% else %}
    bg-green-900/30 border border-green-700 text-green-200
  {% endif %}">
  <!-- Icon -->
  {% if summary.errors > 0 %}
    <svg class="w-5 h-5 text-red-400 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
      <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126ZM12 15.75h.007v.008H12v-.008Z"/>
    </svg>
    <span>
      {{ summary.errors }} spoke{{ 's' if summary.errors != 1 }} with errors
      {% if summary.ok > 0 %}&nbsp;&middot;&nbsp;{{ summary.ok }} ok{% endif %}
    </span>
  {% elif summary.never > 0 %}
    <svg class="w-5 h-5 text-yellow-400 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
      <path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"/>
    </svg>
    <span>
      {{ summary.never }} spoke{{ 's' if summary.never != 1 }} never synced
      {% if summary.ok > 0 %}&nbsp;&middot;&nbsp;{{ summary.ok }} ok{% endif %}
    </span>
  {% else %}
    <svg class="w-5 h-5 text-green-400 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
      <path stroke-linecap="round" stroke-linejoin="round" d="m4.5 12.75 6 6 9-13.5"/>
    </svg>
    <span>All {{ summary.ok }} spoke{{ 's' if summary.ok != 1 }} in sync</span>
  {% endif %}
  <button onclick="document.getElementById('status-banner').remove()"
          class="ml-auto flex-shrink-0 opacity-60 hover:opacity-100 transition-opacity"
          aria-label="Dismiss">
    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
      <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12"/>
    </svg>
  </button>
</div>
{% endif %}

<!-- Hub section -->
<section class="mb-8">
  <h2 class="text-lg font-semibold text-white mb-4 flex items-center gap-2">
    <svg class="w-4 h-4 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
      <path stroke-linecap="round" stroke-linejoin="round" d="M12 21a9 9 0 1 0 0-18 9 9 0 0 0 0 18zM3.6 9h16.8M3.6 15h16.8M12 3a13.5 13.5 0 0 1 0 18M12 3a13.5 13.5 0 0 0 0 18"/>
    </svg>
    Hub
  </h2>
  <div id="hub"
       class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4"
       hx-get="/api/servers?role=hub"
       hx-trigger="every 30s"
       hx-swap="innerHTML">
    {% for server in hub %}
      {% include "partials/server_card.html" %}
    {% else %}
      <p class="text-gray-500 text-sm col-span-full py-4">
        No hub configured. Configure servers in config.yaml.
      </p>
    {% endfor %}
  </div>
</section>

<!-- Spokes section -->
<section class="mb-8">
  <div class="flex items-center justify-between mb-4">
    <h2 class="text-lg font-semibold text-white flex items-center gap-2">
      <svg class="w-4 h-4 text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
        <circle cx="12" cy="12" r="3"/><path d="M12 2v3M12 19v3M4.22 4.22l2.12 2.12M17.66 17.66l2.12 2.12M2 12h3M19 12h3M4.22 19.78l2.12-2.12M17.66 6.34l2.12-2.12"/>
      </svg>
      Spokes
    </h2>

    <!-- Sync All button -->
    <button
      hx-post="/api/sync-all"
      hx-target="#spokes"
      hx-swap="innerHTML"
      class="flex items-center gap-2 bg-purple-700 hover:bg-purple-600 active:bg-purple-800
             text-white text-xs font-medium rounded-md px-3 py-1.5 transition-colors
             focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-offset-2
             focus:ring-offset-gray-900">
      <span class="htmx-indicator" role="status" aria-label="Syncing all...">
        <svg class="w-3.5 h-3.5 animate-spin" fill="none" viewBox="0 0 24 24">
          <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"/>
          <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"/>
        </svg>
      </span>
      <span>Sync All</span>
    </button>
  </div>

  <div id="spokes"
       class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4"
       hx-get="/api/servers?role=spoke"
       hx-trigger="every 30s"
       hx-swap="innerHTML">
    {% for server in spokes %}
      {% include "partials/server_card.html" %}
    {% else %}
      <p class="text-gray-500 text-sm col-span-full py-4">
        No spokes configured. Configure servers in config.yaml.
      </p>
    {% endfor %}
  </div>
</section>

<!-- Settings -->
<section class="mb-8">
  <h2 class="text-lg font-semibold text-white mb-4 flex items-center gap-2">
    <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
      <path stroke-linecap="round" stroke-linejoin="round"
        d="M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.325.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 0 1 1.37.49l1.296 2.247a1.125 1.125 0 0 1-.26 1.431l-1.003.827c-.293.241-.438.613-.43.992a7.723 7.723 0 0 1 0 .255c-.008.378.137.75.43.991l1.004.827c.424.35.534.955.26 1.43l-1.298 2.247a1.125 1.125 0 0 1-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.47 6.47 0 0 1-.22.128c-.331.183-.581.495-.644.869l-.213 1.281c-.09.543-.56.94-1.11.94h-2.594c-.55 0-1.019-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 0 1-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 0 1-1.369-.49l-1.297-2.247a1.125 1.125 0 0 1 .26-1.431l1.004-.827c.292-.24.437-.613.43-.991a6.932 6.932 0 0 1 0-.255c.007-.38-.138-.751-.43-.992l-1.004-.827a1.125 1.125 0 0 1-.26-1.43l1.297-2.247a1.125 1.125 0 0 1 1.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.086.22-.128.332-.183.582-.495.644-.869l.214-1.28Z"/>
      <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"/>
    </svg>
    Settings
  </h2>
  <div id="settings"
       hx-get="/api/settings"
       hx-trigger="every 60s"
       hx-swap="innerHTML">
    {% include "partials/settings.html" %}
  </div>
</section>

<!-- Sync history -->
<section>
  <h2 class="text-lg font-semibold text-white mb-4">Sync History</h2>
  <div id="history"
       hx-get="/api/history"
       hx-trigger="every 30s"
       hx-swap="innerHTML">
    {% include "partials/history.html" %}
  </div>
</section>

{% endblock %}
